# Tesla Lock Sound Creator - 아키텍처 문서

## 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              클라이언트 (브라우저)                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐   ┌────────────┐ │
│   │   app.js    │   │ audio-data  │   │   waveform  │   │ file-system│ │
│   │  (컨트롤러)  │──▶│   (사운드)   │──▶│   (시각화)   │──▶│  (저장)    │ │
│   └─────────────┘   └─────────────┘   └─────────────┘   └────────────┘ │
│          │                                                      │       │
│          │          ┌─────────────┐   ┌─────────────┐          │       │
│          └─────────▶│audio-process│──▶│  gallery.js │──────────┘       │
│                     │   (처리)     │   │ (커뮤니티)   │                  │
│                     └─────────────┘   └──────┬──────┘                  │
│                                              │                          │
└──────────────────────────────────────────────┼──────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           Firebase (백엔드)                              │
├─────────────────────────────────────────────────────────────────────────┤
│   ┌─────────────────────┐         ┌─────────────────────┐              │
│   │     Firestore       │         │      Storage        │              │
│   │  (메타데이터 저장)    │         │   (WAV 파일 저장)    │              │
│   │                     │         │                     │              │
│   │  - 사운드 정보       │         │  - sounds/*.wav     │              │
│   │  - 좋아요 수         │         │  - 최대 1MB         │              │
│   │  - 다운로드 수       │         │                     │              │
│   └─────────────────────┘         └─────────────────────┘              │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 유즈케이스 플로우차트

### 1. 기본 사운드 선택 및 저장

사용자가 12개 기본 사운드 중 하나를 선택하여 USB에 저장하는 플로우

```
┌──────────────────────────────────────────────────────────────────────┐
│                     UC1: 기본 사운드 선택 및 저장                       │
└──────────────────────────────────────────────────────────────────────┘

    ┌─────────┐
    │  시작   │
    └────┬────┘
         │
         ▼
┌─────────────────┐
│ 웹사이트 접속    │
│ (Chrome/Edge)   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐     ┌─────────────────┐
│ 12개 사운드 중   │────▶│ 미리듣기 버튼   │
│ 하나 선택       │◀────│ 클릭하여 확인   │
└────────┬────────┘     └─────────────────┘
         │
         ▼
┌─────────────────┐
│ Step 2로 이동   │
│ 파형 표시       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐     ┌─────────────────┐
│ 트리밍 조정     │────▶│ 2-5초 범위 체크 │
│ (선택사항)      │     │                 │
└────────┬────────┘     └────────┬────────┘
         │                       │
         │◀──────────────────────┘
         ▼
┌─────────────────┐
│ 볼륨 조절       │
│ 페이드 설정     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ "미리듣기" 클릭 │
│ 최종 확인       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Step 3로 이동   │
│ 저장 화면       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ "Save to USB"   │
│ 버튼 클릭       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ USB 폴더 선택   │
│ (브라우저 다이얼로그)│
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ LockChime.wav   │
│ 저장 완료       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 테슬라 설정     │
│ 안내 표시       │
└────────┬────────┘
         │
         ▼
    ┌─────────┐
    │  완료   │
    └─────────┘
```

---

### 2. 사용자 오디오 업로드 및 편집

사용자가 직접 오디오 파일을 업로드하여 편집하는 플로우

```
┌──────────────────────────────────────────────────────────────────────┐
│                    UC2: 사용자 오디오 업로드 및 편집                    │
└──────────────────────────────────────────────────────────────────────┘

    ┌─────────┐
    │  시작   │
    └────┬────┘
         │
         ▼
┌─────────────────┐
│ "Upload Your    │
│  Audio" 영역    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐     ┌─────────────────┐
│ 파일 드래그&드롭│     │ 또는 클릭하여   │
│                 │ OR  │ 파일 선택       │
└────────┬────────┘     └────────┬────────┘
         │                       │
         └───────────┬───────────┘
                     ▼
         ┌─────────────────┐
         │ 파일 유효성 검사 │
         └────────┬────────┘
                  │
         ┌────────┴────────┐
         ▼                 ▼
┌─────────────────┐ ┌─────────────────┐
│ 유효한 포맷     │ │ 잘못된 포맷     │
│ (WAV/MP3/M4A/OGG)│ │ 에러 메시지     │
└────────┬────────┘ └─────────────────┘
         │
         ▼
┌─────────────────┐
│ Web Audio API   │
│ 디코딩          │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Step 2 표시     │
│ 파형 렌더링     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 드래그 핸들로   │
│ 구간 트리밍     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 길이 검증       │
│ (2-5초)         │
└────────┬────────┘
         │
    ┌────┴────┐
    ▼         ▼
┌───────┐ ┌───────────┐
│ 유효  │ │ 범위 초과  │
│       │ │ 경고 표시  │
└───┬───┘ └─────┬─────┘
    │           │
    │◀──────────┘ (재조정)
    ▼
┌─────────────────┐
│ 볼륨/페이드     │
│ 설정            │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 오디오 처리     │
│ (정규화, 변환)  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ WAV 인코딩      │
│ (Mono, 44.1kHz) │
└────────┬────────┘
         │
         ▼
    ┌─────────┐
    │ Step 3  │
    │  저장   │
    └─────────┘
```

---

### 3. 커뮤니티 갤러리에서 사운드 다운로드

갤러리에서 다른 사용자의 사운드를 찾아 사용하는 플로우

```
┌──────────────────────────────────────────────────────────────────────┐
│                   UC3: 갤러리에서 사운드 다운로드                       │
└──────────────────────────────────────────────────────────────────────┘

    ┌─────────┐
    │  시작   │
    └────┬────┘
         │
         ▼
┌─────────────────┐
│ Community       │
│ Gallery 섹션    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Firebase에서    │
│ 사운드 목록 로드│
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 갤러리 그리드   │
│ 표시            │
└────────┬────────┘
         │
    ┌────┴────────────────────┐
    ▼                         ▼
┌───────────┐         ┌───────────────┐
│ 검색어    │         │ 카테고리 필터 │
│ 입력      │         │ 선택          │
└─────┬─────┘         └───────┬───────┘
      │                       │
      └───────────┬───────────┘
                  ▼
┌─────────────────────────────┐
│ 필터링된 결과 표시          │
│ (이름, 카테고리, 좋아요 등) │
└────────────┬────────────────┘
             │
             ▼
┌─────────────────────────────┐
│ 사운드 카드 선택            │
└────────────┬────────────────┘
             │
    ┌────────┴────────┬───────────────┐
    ▼                 ▼               ▼
┌─────────┐    ┌──────────┐    ┌──────────┐
│ 미리듣기 │    │ 좋아요   │    │ 사용하기 │
│ 버튼    │    │ 버튼     │    │ 버튼     │
└────┬────┘    └────┬─────┘    └────┬─────┘
     │              │               │
     ▼              ▼               ▼
┌─────────┐  ┌───────────┐  ┌────────────┐
│ 오디오  │  │ 좋아요 수 │  │ WAV 다운로드│
│ 재생    │  │ 증가/감소 │  │            │
└─────────┘  │ localStorage│  └─────┬──────┘
             │ 저장       │        │
             └───────────┘        ▼
                          ┌────────────┐
                          │ Step 2로   │
                          │ 자동 이동  │
                          └─────┬──────┘
                                │
                                ▼
                          ┌────────────┐
                          │ 추가 편집  │
                          │ 가능       │
                          └─────┬──────┘
                                │
                                ▼
                          ┌──────────┐
                          │  Step 3  │
                          │   저장   │
                          └──────────┘
```

---

### 4. 커뮤니티 갤러리에 사운드 업로드

내가 만든 사운드를 갤러리에 공유하는 플로우

```
┌──────────────────────────────────────────────────────────────────────┐
│                    UC4: 갤러리에 사운드 업로드                         │
└──────────────────────────────────────────────────────────────────────┘

    ┌─────────┐
    │  시작   │
    └────┬────┘
         │
         ▼
┌─────────────────┐
│ 사운드 편집     │
│ 완료 (Step 2)   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Step 3          │
│ 저장 화면       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ "Upload to      │
│  Gallery" 클릭  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 업로드 모달     │
│ 표시            │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 메타데이터 입력 │
│ - 이름 (필수)   │
│ - 설명 (선택)   │
│ - 카테고리      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 입력 검증       │
│ - 이름 50자 이하│
│ - 설명 200자 이하│
└────────┬────────┘
         │
    ┌────┴────┐
    ▼         ▼
┌───────┐ ┌───────────┐
│ 유효  │ │ 검증 실패 │
│       │ │ 에러 표시 │
└───┬───┘ └───────────┘
    │
    ▼
┌─────────────────┐
│ Firebase Storage│
│ WAV 업로드      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Firestore       │
│ 메타데이터 저장 │
│ - 이름, 설명    │
│ - 카테고리      │
│ - 파일 URL      │
│ - 생성일        │
│ - 익명 ID       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 업로드 완료     │
│ 토스트 알림     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 갤러리에        │
│ 새 사운드 표시  │
└────────┬────────┘
         │
         ▼
    ┌─────────┐
    │  완료   │
    └─────────┘
```

---

### 5. 오프라인 사용 (PWA)

서비스 워커를 통한 오프라인 기능 플로우

```
┌──────────────────────────────────────────────────────────────────────┐
│                        UC5: 오프라인 사용 (PWA)                        │
└──────────────────────────────────────────────────────────────────────┘

    ┌─────────┐
    │  시작   │
    └────┬────┘
         │
         ▼
┌─────────────────┐
│ 첫 방문 시      │
│ 서비스 워커 등록│
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 정적 에셋 캐싱  │
│ - HTML, CSS, JS │
│ - 아이콘        │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ PWA 설치 프롬프트│
│ (선택사항)      │
└────────┬────────┘
         │
         │
    ┌────┴────────────────┐
    ▼                     ▼
┌────────────┐     ┌────────────┐
│ 온라인 상태 │     │ 오프라인   │
│            │     │ 상태       │
└─────┬──────┘     └─────┬──────┘
      │                  │
      ▼                  ▼
┌────────────┐     ┌────────────┐
│ 네트워크   │     │ 캐시에서   │
│ 요청       │     │ 응답       │
└─────┬──────┘     └─────┬──────┘
      │                  │
      ▼                  ▼
┌────────────┐     ┌────────────┐
│ 모든 기능  │     │ 기본 기능  │
│ 사용 가능  │     │ 사용 가능  │
│            │     │            │
│ ✓ 기본 사운드│     │ ✓ 기본 사운드│
│ ✓ 업로드    │     │ ✓ 업로드   │
│ ✓ 편집      │     │ ✓ 편집     │
│ ✓ USB 저장  │     │ ✓ USB 저장 │
│ ✓ 갤러리    │     │ ✗ 갤러리   │
└────────────┘     └────────────┘
                         │
                         ▼
                  ┌────────────┐
                  │ 오프라인   │
                  │ 페이지 표시│
                  │ (갤러리용) │
                  └────────────┘
```

---

## 데이터 플로우

### 오디오 처리 파이프라인

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          오디오 처리 파이프라인                           │
└─────────────────────────────────────────────────────────────────────────┘

┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│ 입력     │    │ 디코딩   │    │ 처리     │    │ 인코딩   │    │ 출력     │
│          │───▶│          │───▶│          │───▶│          │───▶│          │
│ Source   │    │ Decode   │    │ Process  │    │ Encode   │    │ Output   │
└──────────┘    └──────────┘    └──────────┘    └──────────┘    └──────────┘
     │               │               │               │               │
     ▼               ▼               ▼               ▼               ▼
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│• 기본 사운드│    │• AudioContext│   │• 트리밍    │    │• PCM 변환 │    │• Blob    │
│• 업로드 파일│    │• decodeAudio │   │• 리샘플링  │    │• WAV 헤더 │    │• 파일 저장│
│• 갤러리    │    │  Data       │   │• 모노 변환 │    │• 16-bit   │    │• 다운로드│
│           │    │• Float32    │   │• 정규화    │    │• 44.1kHz  │    │          │
│           │    │  Array      │   │• 페이드    │    │           │    │          │
│           │    │             │   │• 볼륨 조절 │    │           │    │          │
└──────────┘    └──────────┘    └──────────┘    └──────────┘    └──────────┘
```

---

## 컴포넌트 상호작용

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           컴포넌트 상호작용 다이어그램                     │
└─────────────────────────────────────────────────────────────────────────┘

                              ┌─────────────┐
                              │   app.js    │
                              │  (메인 앱)   │
                              └──────┬──────┘
                                     │
           ┌─────────────┬───────────┼───────────┬─────────────┐
           │             │           │           │             │
           ▼             ▼           ▼           ▼             ▼
    ┌────────────┐ ┌───────────┐ ┌────────┐ ┌──────────┐ ┌──────────┐
    │ audio-data │ │audio-proc │ │waveform│ │file-system│ │ gallery  │
    │            │ │           │ │        │ │          │ │          │
    │ • 12 사운드 │ │ • 재생    │ │ • 캔버스│ │ • USB 저장│ │ • 업로드 │
    │ • 합성     │ │ • 트리밍  │ │ • 드래그│ │ • 다운로드│ │ • 검색   │
    │ • WAV 변환 │ │ • 효과    │ │ • 핸들  │ │ • 브라우저│ │ • 좋아요 │
    └────────────┘ └───────────┘ └────────┘ └──────────┘ └──────────┘
           │             │           │           │             │
           │             │           │           │             │
           ▼             ▼           ▼           ▼             ▼
    ┌────────────┐ ┌───────────┐ ┌────────┐ ┌──────────┐ ┌──────────┐
    │ Web Audio  │ │AudioBuffer│ │ Canvas │ │ File API │ │ Firebase │
    │ API        │ │           │ │ API    │ │          │ │          │
    └────────────┘ └───────────┘ └────────┘ └──────────┘ └──────────┘
```

---

## 상태 다이어그램

### 애플리케이션 상태 전이

```
┌─────────────────────────────────────────────────────────────────────────┐
│                            애플리케이션 상태 전이                          │
└─────────────────────────────────────────────────────────────────────────┘

                         ┌─────────────┐
                         │    INIT     │
                         │   (초기화)   │
                         └──────┬──────┘
                                │
                                │ 페이지 로드
                                ▼
                         ┌─────────────┐
              ┌─────────│   STEP 1    │─────────┐
              │         │  (사운드 선택)│         │
              │         └──────┬──────┘         │
              │                │                │
              │ 갤러리         │ 사운드 선택     │ 업로드
              │ 클릭           │                │
              ▼                ▼                ▼
       ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
       │   GALLERY   │  │   STEP 2    │  │  UPLOADING  │
       │  (갤러리)    │  │   (편집)    │  │  (업로드중)  │
       └──────┬──────┘  └──────┬──────┘  └──────┬──────┘
              │                │                │
              │ 사운드 사용     │ 편집 완료       │ 완료
              │                │                │
              └───────────────▶├◀───────────────┘
                               │
                               ▼
                        ┌─────────────┐
                        │   STEP 3    │
                        │   (저장)    │
                        └──────┬──────┘
                               │
              ┌────────────────┼────────────────┐
              │                │                │
              ▼                ▼                ▼
       ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
       │    SAVING   │  │ DOWNLOADING │  │ GALLERY     │
       │  (USB 저장)  │  │  (다운로드)  │  │ UPLOAD      │
       └──────┬──────┘  └──────┬──────┘  └──────┬──────┘
              │                │                │
              └────────────────┼────────────────┘
                               │
                               ▼
                        ┌─────────────┐
                        │   SUCCESS   │
                        │   (완료)    │
                        └──────┬──────┘
                               │
                               │ 다시 만들기
                               ▼
                        ┌─────────────┐
                        │   STEP 1    │
                        └─────────────┘
```

---

## Firebase 데이터 구조

### Firestore 컬렉션

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         Firestore 데이터 구조                            │
└─────────────────────────────────────────────────────────────────────────┘

sounds (컬렉션)
│
├── sound_abc123xyz (문서)
│   ├── id: "sound_abc123xyz"
│   ├── name: "Epic Horn"
│   ├── description: "Deep brass horn sound"
│   ├── category: "classic"
│   ├── duration: 3.5
│   ├── fileSize: 154628
│   ├── downloadUrl: "https://storage.googleapis.com/..."
│   ├── fileName: "sound_abc123xyz.wav"
│   ├── likes: 42
│   ├── downloads: 156
│   ├── createdAt: Timestamp
│   └── creatorId: "anon_xyz789"
│
├── sound_def456uvw (문서)
│   └── ...
│
└── ...
```

### Storage 구조

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          Storage 파일 구조                               │
└─────────────────────────────────────────────────────────────────────────┘

bucket/
│
└── sounds/
    ├── sound_abc123xyz.wav
    ├── sound_def456uvw.wav
    ├── sound_ghi789rst.wav
    └── ...
```

---

## 보안 규칙 요약

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              보안 규칙                                   │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│ Firestore                                                               │
├─────────────────────────────────────────────────────────────────────────┤
│ sounds 컬렉션:                                                          │
│   • READ:   모든 사용자 ✓                                               │
│   • CREATE: 모든 사용자 ✓                                               │
│   • UPDATE: likes, downloads 필드만 ✓                                   │
│   • DELETE: 불가 ✗                                                      │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│ Storage                                                                 │
├─────────────────────────────────────────────────────────────────────────┤
│ sounds/ 폴더:                                                           │
│   • READ:  모든 사용자 ✓                                                │
│   • WRITE: 조건부 ✓                                                     │
│     - 파일 크기 < 1MB                                                   │
│     - Content-Type = audio/wav                                          │
│   • DELETE: 불가 ✗                                                      │
└─────────────────────────────────────────────────────────────────────────┘
```
